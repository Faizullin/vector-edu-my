import{r as x,j as e,R,C as f,A as w,x as d,B as N,D as F,E as B,G as A,H as L}from"./main-CUfsI3AY.js";import{M as V}from"./MainCard-D5eZyF4J.js";import{D as G}from"./DataTable-CxqS4FPA.js";import{u as I,a as U}from"./useApi-muFL2Lva.js";import{B as J}from"./BaseDeleteConfirmationModal-BTZuvhXW.js";import{c as P,a as M,F as K,b as q,d as k,E as D,e as Q,f as W,C as X}from"./CSelect-DrjsPD9C.js";import{u as Y}from"./useFormManager-B03DyPJs.js";import{M as m}from"./Modal-CKnJLuZW.js";import{S as H}from"./Spinner-B_7WowvM.js";import"./Card-B4mrgJ9R.js";import"./TransitionWrapper-QYPjZsTZ.js";import"./lodash-CVgaKlHN.js";import"./Table-I26n7k9G.js";import"./hasClass-CIfd7_8j.js";const T="/lms/resources/categories/",Z=({open:u,onClose:o,record:t,onSuccess:i})=>{const n=I(),[h,l]=x.useState(t||{}),y=!!h.id,v={title:h.title||"",term:h.term||(t==null?void 0:t.term)||"",description:h.description||""},j=P().shape({title:M().required("Title is required"),term:M().required("Term is required"),description:M().nullable()}),a=async(c,p)=>{var b,g;try{if(y){const r=await n.mutate(`${T}/${h.id}/`,"PUT",c);l(r),F.success("Category updated!"),i==null||i(r)}else{const r=await n.mutate(`${T}/`,"POST",c);l(r),F.success("Category created! Switching to update mode..."),i==null||i(r)}}catch(r){if(((b=r==null?void 0:r.response)==null?void 0:b.status)===400&&((g=r.response)!=null&&g.data)){const s=r.response.data;s.non_field_errors&&F.error(s.non_field_errors.join(", ")),s.message&&Object.entries(s.message).forEach(([C,E])=>{p.setFieldError(C,E)})}else F.error((r==null?void 0:r.message)||"Something went wrong.")}finally{p.setSubmitting(!1)}};return x.useEffect(()=>{l(t||{})},[t]),e.jsx(m,{show:u,onHide:o,size:"lg",centered:!0,children:e.jsx(K,{enableReinitialize:!0,initialValues:v,validationSchema:j,onSubmit:a,children:({handleSubmit:c,touched:p,errors:b,isSubmitting:g})=>e.jsxs(q,{onSubmit:c,children:[e.jsx(m.Header,{closeButton:!0,children:e.jsx(m.Title,{children:y?"Edit Category":"Create Category"})}),e.jsx(m.Body,{children:e.jsxs(R,{className:"g-3",children:[e.jsx(f,{md:12,children:e.jsxs(w,{label:"Title",children:[e.jsx(k,{name:"title",as:d.Control,type:"text",isInvalid:p.title&&!!b.title,placeholder:"Enter category title"}),e.jsx(D,{name:"title",component:d.Control.Feedback,type:"invalid"})]})}),e.jsx(f,{md:12,children:e.jsxs(w,{label:"Term",children:[e.jsx(k,{name:"term",as:d.Control,type:"text",isInvalid:p.term&&!!b.term,placeholder:"Enter category term"}),e.jsx(D,{name:"term",component:d.Control.Feedback,type:"invalid"})]})}),e.jsx(f,{md:12,children:e.jsxs(w,{label:"Description",children:[e.jsx(k,{name:"description",as:"textarea",className:`form-control ${p.description&&b.description?"is-invalid":""}`,placeholder:"Category description",rows:4,style:{minHeight:"120px"}}),e.jsx(D,{name:"description",component:d.Control.Feedback,type:"invalid"})]})}),n.error&&e.jsx("p",{className:"text-danger mt-2",children:n.error.message||"Submission failed."})]})}),e.jsxs(m.Footer,{children:[e.jsx(N,{variant:"secondary",onClick:o,children:"Cancel"}),e.jsx(N,{variant:"primary",type:"submit",disabled:g||n.loading,children:g||n.loading?e.jsxs(e.Fragment,{children:[e.jsx(H,{animation:"border",size:"sm",className:"me-2"}),"Saving..."]}):y?"Update":"Create"})]})]})})})},_="/lms/resources/posts",$=u=>({value:u.id,label:u.title});function S({open:u,onClose:o,record:t,onSuccess:i}){var g,r;const n=U("/lms/resources/categories/",{useInitial:!1,usePagination:!1}),{showModal:h}=B(),l=Y({getUrl:s=>s?`${_}/${s.id}/`:`${_}/`,schema:P().shape({title:M().required("Title is required"),category:P().nullable(),publication_status:Q().oneOf([0,1],"Invalid status").required()}),parseResponse:s=>s,parseFormData:s=>{var C;return{...s,category:((C=s.category)==null?void 0:C.value)||null}},initialValues:{title:"",category:null,publication_status:0},onSubmit:s=>{s.status==="success"&&(i==null||i(s))}}),{handleSubmit:y,touched:v,errors:j,isSubmitting:a,values:c,setValues:p,setFieldValue:b}=l.formik;return x.useEffect(()=>{t&&(l.setRecord(t),p({title:t.title,publication_status:t.publication_status,category:t.category?$(t.category):null}))},[t]),e.jsx(m,{show:u,onHide:o,size:"lg",centered:!0,children:e.jsx(W,{value:l.formik,children:e.jsxs(q,{onSubmit:y,children:[e.jsx(m.Header,{closeButton:!0,children:e.jsx(m.Title,{children:(g=l.record)!=null&&g.id?"Edit Post":"Create Post"})}),e.jsx(m.Body,{children:e.jsxs(R,{className:"g-3",children:[e.jsx(f,{md:12,children:e.jsxs(w,{label:"Title",children:[e.jsx(k,{name:"title",as:d.Control,type:"text",isInvalid:v.title&&!!j.title,placeholder:"Enter post title"}),e.jsx(D,{name:"title",component:d.Control.Feedback,type:"invalid"})]})}),e.jsxs(f,{md:12,children:[e.jsx("label",{className:"form-label",children:"Category"}),e.jsx(k,{name:"category",component:X,value:c.category,dataLoadFn:n.fetchData,dataLoadParserFn:$,actions:{create_edit:{fn:({mode:s,record:C})=>{const E={open:!0,onSuccess:z=>{b("category",$(z))}};if(s==="edit"){if(!C)throw new Error("localRecord.category is empty");E.record=C}else if(s==="create")E.record={term:"posts"};else throw new Error("mode must be edit or create");h(Z,E,{destroyOnClose:!0,hideOnClose:!0})}}}}),v.category&&j.category&&e.jsx(d.Control.Feedback,{type:"invalid",className:"d-block",children:j.category})]}),e.jsxs(f,{md:12,children:[e.jsx("label",{className:"form-label",children:"Publication Status"}),e.jsxs(k,{as:d.Select,name:"publication_status",className:"form-control",children:[e.jsx("option",{value:0,children:"Draft"}),e.jsx("option",{value:1,children:"Published"})]}),e.jsx(D,{name:"publication_status",component:d.Control.Feedback,type:"invalid"})]}),l.saveControl.error&&e.jsx("p",{className:"text-danger mt-2",children:l.saveControl.error.message||"Submission failed."})]})}),e.jsxs(m.Footer,{children:[e.jsx(N,{variant:"secondary",onClick:o,children:"Cancel"}),e.jsx(N,{variant:"primary",type:"submit",disabled:a||l.saveControl.loading,children:a||l.saveControl.loading?e.jsxs(e.Fragment,{children:[e.jsx(H,{animation:"border",size:"sm",className:"me-2"}),"Saving..."]}):(r=l.record)!=null&&r.id?"Update":"Create"})]})]})})})}const O="/lms/resources/posts";function pe(){const u=A(),{showModal:o}=B(),t=U(`${O}/`,{useInitial:!1}),i=I(),n=x.useMemo(()=>[{key:"id",label:"Id",sortable:!0},{key:"title",label:"Title"},{key:"author",label:"Author",render:a=>a.author?a.author.username:null},{key:"category",label:"Category",render:a=>a.category?a.category.title:null},{key:"publication_status",label:"Published"},{key:"created_at",label:"Created",dataType:"datetime",sortable:!0},{key:"updated_at",label:"Updated",dataType:"datetime",sortable:!0}],[]),h=x.useCallback(a=>{t.fetchData(a)},[t.fetchData]),l=x.useCallback(()=>{o(S,{open:!0,onSuccess:()=>{t.fetchData()},onClose:()=>{}},{destroyOnClose:!0,hideOnClose:!0})},[o,t.fetchData]),y=x.useCallback(a=>{o(S,{open:!0,record:a,onSuccess:()=>{t.fetchData()}},{destroyOnClose:!0,hideOnClose:!0})},[t.fetchData]),v=x.useCallback(a=>{const c=o(J,{open:!0,title:"Delete Item",message:`Are you sure you want to delete "${a.title}"?`,loading:t.loading,onConfirm:async()=>{try{await i.mutate(`${O}/${a.id}/`,"DELETE"),F.success("Item deleted successfully!"),await t.fetchData(),c.hide()}catch{F.error("Failed to delete item.")}}},{destroyOnClose:!0,hideOnClose:!0})},[t.fetchData]),j=x.useCallback(a=>{const c=`/resources/posts/${a.id}/edit-content?type=editor1`;u(c)},[u]);return e.jsx(R,{children:e.jsx(f,{sm:12,children:e.jsxs(V,{title:"Pasts",children:[e.jsxs("div",{className:"align-items-center m-l-0 row",children:[e.jsx("div",{className:"col-sm-6"}),e.jsx("div",{className:"text-end col-sm-6",children:e.jsxs("button",{type:"button",className:"btn-sm btn-round mb-3 btn btn-success",onClick:l,children:[e.jsx("i",{className:"feather icon-plus"})," Add"]})})]}),e.jsx(G,{columns:n,control:t,onEdit:y,onDelete:v,extraActions:a=>e.jsx(e.Fragment,{children:e.jsx(L.Item,{onClick:()=>j(a),children:"Edit Content"})}),onFilterChange:h})]})})})}export{pe as default};
