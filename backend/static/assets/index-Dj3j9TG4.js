import{M as D,G as w,E as L,r as a,D as p,j as e,R,C as _,B as m,X as v}from"./main-CUfsI3AY.js";import{M as z}from"./MainCard-D5eZyF4J.js";import{B as A}from"./BaseDeleteConfirmationModal-BTZuvhXW.js";import{a as B,u}from"./useApi-muFL2Lva.js";import{d as I}from"./dragula-2h0MsBYZ.js";import{S as T}from"./Spinner-B_7WowvM.js";import"./Card-B4mrgJ9R.js";import"./TransitionWrapper-QYPjZsTZ.js";import"./Modal-CKnJLuZW.js";import"./hasClass-CIfd7_8j.js";const i="/lms/lessons/pages",j=t=>t.sort((d,l)=>d.order-l.order);function Z(){const{lesson_id:t}=D(),d=w(),l=L(),[o,c]=a.useState([]),n=B(`${i}/?lesson_id=${t}`,{useInitial:!0,usePagination:!1}),C=u(),h=u(),f=u(),y=u(),P=a.useCallback(()=>{C.mutate(`${i}/`,"POST",{lesson:t}).then(s=>{c(r=>j([...r,s]))})},[]),b=a.useCallback(s=>{const r=l.showModal(A,{open:!0,title:"Delete Item",message:`Are you sure you want to delete "Lesson #${s.id}"?`,loading:h.loading,onConfirm:async({modalManager:g})=>{try{await h.mutate(`${i}/${s.id}/`,"DELETE"),p.success("Item deleted successfully!"),await n.fetchData(),g.hideModal(r.id)}catch{p.error("Failed to delete item.")}}},{destroyOnClose:!0,hideOnClose:!0})},[n.fetchData,h.mutate,l]),x=a.useRef(null);a.useEffect(()=>{n.data&&c(j(n.data))},[n.data]),a.useEffect(()=>{if(x.current){const s=I([x.current],{});return s.on("drop",(r,g,N,G)=>{const O=Array.from(g.children).map(S=>{const $=S.getAttribute("data-id");return o.find(k=>String(k.id)===$)});c(O)}),()=>{s.destroy()}}},[o,t]);const E=a.useCallback(s=>{y.mutate(`${i}/${s.id}/get-editor/`,"POST").then(r=>{d(`/resources/posts/${r.post.id}/edit-content?type=editor1`)})},[t,d]),M=a.useCallback(()=>{f.mutate(`${i}/reorder/`,"POST",{ordered_ids:o.map(s=>s.id),lesson_id:t}).then(s=>{c(j(s)),p.success("Pages reordered successfully!")})},[o,t,f.mutate]);return e.jsx(R,{children:e.jsx(_,{sm:12,children:e.jsxs(z,{title:"Lesson Pages",children:[e.jsxs("div",{className:"align-items-center m-l-0 row",children:[e.jsx("div",{className:"col-sm-6"}),e.jsxs("div",{className:"text-end col-sm-6",children:[e.jsxs(m,{variant:"info",size:"sm",onClick:M,disabled:f.loading,className:"me-2",children:[e.jsx("i",{className:"feather icon-save"})," Save Order"]}),e.jsxs(m,{variant:"success",size:"sm",onClick:P,disabled:C.loading,children:[e.jsx("i",{className:"feather icon-plus"})," Add Page"]})]})]}),n.loading?e.jsx("div",{className:"text-center py-5",children:e.jsx(T,{animation:"border"})}):o.length===0?e.jsx("div",{className:"text-muted",children:"No pages available."}):e.jsx(v,{ref:x,children:o.map((s,r)=>e.jsxs(v.Item,{"data-id":s.id,className:"d-flex justify-content-between align-items-center",style:{cursor:"move"},children:[e.jsxs("div",{children:[e.jsxs("strong",{children:["#",s.id]})," - ",s.title]}),e.jsx("div",{children:e.jsx(m,{variant:"outline-primary",size:"sm",onClick:()=>E(s),children:"Open Editor"})}),e.jsx("div",{children:e.jsx(m,{variant:"outline-danger",size:"sm",onClick:()=>b(s),children:"Delete"})})]},s.id))})]})})})}export{Z as default};
