import{e as C,b as N,r as t,j as e,N as T}from"./index-BmiyAELg.js";import{a as n,s as r}from"./use-auth-js2yB0WI.js";import{c as M,u as O,a as _,D as k}from"./use-custom-toast-CvPjYmcL.js";import{D as E,a as L}from"./delete-confirm-nice-dialog-BuUCB31W.js";import{H as $,T as z,P as A,M as I}from"./theme-switch-_yrpSE89.js";import{S as R}from"./search-BqZfjb3Q.js";import{B as h}from"./createReactComponent-DAnOonP9.js";import{S as q,a as F,I as H,D as B}from"./DndDatatable-DmaSDS4J.js";import"./IconSun-CD0sLG3_.js";import"./handle-server-error-D0TgnIKM.js";import"./search-context-emn1PgDM.js";const i=M();function G(){const m=C({from:"/_layout/lessons/$lesson_id/pages"}),{lesson_id:l}=m,g=N(),{showSuccessToast:j}=O(),S=n({mutationFn:s=>r({url:`/lessons/pages/${s}/`,method:"DELETE"})}),b=n({mutationFn:s=>r({url:`/lessons/pages/${s}/get-editor/`,method:"POST"})}),D=t.useMemo(()=>[i.display({id:"dragHandle",size:40}),i.accessor("id",{header:"ID",enableSorting:!1}),i.accessor("order",{header:"Order",enableSorting:!1}),i.display({id:"actions",cell:({row:s})=>e.jsx(E,{row:s,actions:{openPages:{label:"Open Editor",shortcutIcon:e.jsx(q,{}),callback:({row:a})=>{b.mutate(a.original.id,{onSuccess(u){const y=`/resources/posts/${u.post.id}/edit-content?type=editor2&lesson_page_id=${a.original.id}`;window.open(y,"_blank")}})}}},defaultActions:{delete:{callback:({row:a})=>{T.show(L,{}).then(({result:u})=>{u&&(j({title:"Lesson deleted successfully",duration:2e3}),S.mutateAsync(a.original.id).then(()=>{o.query.refetch()}))})}}}})})],[g]),o=_({name:"lessons",url:"/lessons/pages",columns:D,transformToApiParams(s){return{...s,lesson_id:l,page:1,page_size:100,ordering:"-order"}}}),c=n({mutationFn:s=>r({url:"/lessons/pages/",method:"POST",formData:{lesson:`${s}`}}),onSuccess:()=>{o.query.refetch()}}),[d,p]=t.useState(!1),x=n({mutationFn:({lessonId:s,dataIds:a})=>r({url:"/lessons/pages/reorder/",method:"POST",formData:{lesson_id:`${s}`,ordered_ids:a.reverse()}}),onSuccess:()=>{o.query.refetch(),p(!1)}}),[f,P]=t.useState([]),w=t.useCallback(()=>{c.mutate(l)},[c]),v=t.useCallback(()=>{d&&x.mutate({lessonId:l,dataIds:f.map(s=>s.id)})},[x,d,f]);return e.jsxs(e.Fragment,{children:[e.jsxs($,{fixed:!0,children:[e.jsx(R,{}),e.jsxs("div",{className:"ml-auto flex items-center space-x-4",children:[e.jsx(z,{}),e.jsx(A,{})]})]}),e.jsxs(I,{children:[e.jsxs("div",{className:"mb-2 flex flex-wrap items-center justify-between space-y-2",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold tracking-tight",children:"Lesson Page List"}),e.jsx("p",{className:"text-muted-foreground",children:"This is the list of lesson pages."})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(k,{actions:[]}),e.jsxs(h,{className:"space-x-1",size:"sm",onClick:v,disabled:!d,children:[e.jsx("span",{children:"Save"})," ",e.jsx(F,{size:18})]}),e.jsxs(h,{className:"space-x-1",onClick:w,disabled:c.isPending,size:"sm",children:[e.jsx("span",{children:"Add"})," ",e.jsx(H,{size:18})]})]})]}),e.jsx("div",{className:"-mx-4 flex-1 overflow-auto px-4 py-1 lg:flex-row lg:space-y-0 lg:space-x-12",children:e.jsx(B,{resource:o,onReorder:s=>{P(s),p(!0)}})})]})]})}const te=function(){return e.jsx(G,{})};export{te as component};
