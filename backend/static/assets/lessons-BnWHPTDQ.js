import{N as w,s as y,r as i,j as e,z as S,a as oe,b as re}from"./index-DQh6-uld.js";import{c as K,a as ne,g as le,b as ce,T as ie,d as de,e as O,f as ue,h as G,i as me,j as pe,k as U,L as A,u as he,D as ge}from"./use-resource-D_Sf-gj9.js";import{D as Q,a as Y}from"./delete-confirm-nice-dialog-GvGx0jE2.js";import{H as xe,T as be,P as fe,M as je}from"./theme-switch-CZRbTvJb.js";import{S as ye}from"./search-Cxg_x99o.js";import{u as R,C as Se,a as _e,b as we}from"./use-custom-toast-M785XCYm.js";import{a as $}from"./use-auth-D3uw0lD2.js";import{u as N}from"./useMutation-DppR1fuU.js";import{B,c as P}from"./index-DxnMLqFP.js";import{S as Ce}from"./scroll-area-Dbi-VXH4.js";import{S as De,o as ve,p as Ne,q as Te,r as Me,s as ke}from"./dropdown-menu-DzwRwAUd.js";import{g as Ie,S as Pe,u as Fe,a as E,b as Le,c as Ee,D as Oe,r as Re,d as $e,e as qe,v as Ve,f as J,G as Ae,K as Be,T as He,M as ze,C as Ke,h as Ge}from"./textarea-BovfZguL.js";import{c as Ue}from"./createReactComponent-CHdwuXdO.js";import{a as Qe,c as Ye,C as Je}from"./component-base-BGAKgd9u.js";import{S as We}from"./select-dropdown-zAryhJnq.js";import{F as Xe,a as C,b as D,c as v,d as M,e as k}from"./zod-DllzZRz3.js";import{I as H}from"./handle-server-error-BxJ_sWNo.js";import{B as Ze}from"./book-open-D40lXvm_.js";import{P as es}from"./plus-B1eArzAP.js";import"./badge-CaQ6wKJ8.js";import"./search-context-BRsiDa6R.js";import"./IconSun-DUeqE8X5.js";import"./separator-B8KvN21v.js";/**
 * @license @tabler/icons-react v3.31.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var ss=Ue("outline","plus","IconPlus",[["path",{d:"M12 5l0 14",key:"svg-0"}],["path",{d:"M5 12l14 0",key:"svg-1"}]]);const as=(c,d)=>w.show(c,d),I=K();function ts({open:c,onOpenChange:d,lessonId:u}){const{showSuccessToast:x}=R(),b=N({mutationFn:n=>y({url:`/lessons/pages/${n}/`,method:"DELETE"})}),p=N({mutationFn:n=>y({url:`/lessons/pages/${n}/get-editor/`,method:"POST"})}),[r,f]=i.useState([]),a=$({queryKey:["lesson-pages",u],queryFn:()=>y({url:"/lessons/pages",method:"GET",query:{lesson_id:u,ordering:"-order",disablePagination:!0}}),enabled:!!u});i.useEffect(()=>{f(a.data||[])},[a.data]);const t=N({mutationFn:n=>y({url:"/lessons/pages/",method:"POST",formData:{lesson:`${n}`}}),onSuccess:()=>{a.refetch()}}),[h,j]=i.useState(!1),o=N({mutationFn:({lessonId:n,dataIds:s})=>y({url:"/lessons/pages/reorder/",method:"POST",formData:{lesson_id:`${n}`,ordered_ids:s.reverse()}}),onSuccess:()=>{a.refetch(),j(!1)}}),m=i.useCallback(()=>{t.mutate(u)},[t,u]),F=i.useCallback(()=>{h&&o.mutate({lessonId:u,dataIds:r.map(n=>n.id)})},[o,h,r,u]),W=n=>{const s=r.findIndex(l=>l.id===n);if(s>0){const l=[...r],g=l[s-1];l[s-1]=l[s],l[s]=g,f(l),j(!0)}},X=n=>{const s=r.findIndex(l=>l.id===n);if(s<r.length-1){const l=[...r],g=l[s+1];l[s+1]=l[s],l[s]=g,f(l),j(!0)}},q=i.useMemo(()=>[I.display({id:"drag-handle",header:"Move",cell:({row:n})=>e.jsx(rs,{rowId:n.id}),size:40}),I.accessor("id",{header:"ID",enableSorting:!1}),I.accessor("order",{header:"Order",enableSorting:!1}),I.display({id:"actions",cell:({row:n})=>e.jsx(Q,{row:n,actions:{moveUp:{label:"Move Up",shortcutIcon:e.jsx(_e,{}),callback:({row:s})=>{W(s.original.id)}},moveDown:{label:"Move Down",shortcutIcon:e.jsx(Se,{}),callback:({row:s})=>{X(s.original.id)}},openPages:{label:"Open Editor",shortcutIcon:e.jsx(Pe,{}),callback:({row:s})=>{p.mutate(s.original.id,{onSuccess(l){const g=l.post;window.open(Ie(u,s.original.id,g.id),"_blank")}})}}},defaultActions:{delete:{callback:({row:s})=>{w.show(Y,{}).then(({result:l})=>{l&&(x({title:"Page deleted successfully",duration:2e3}),b.mutateAsync(s.original.id).then(()=>{a.refetch()}))})}}}})})],[u]),Z=i.useMemo(()=>r.map(({id:n})=>`${n}`),[r]),ee=Fe(E(ze,{}),E(He,{}),E(Be,{})),se=i.useCallback(n=>{const{active:s,over:l}=n;if(l&&s.id!==l.id){const g=r,T=g.findIndex(L=>`${L.id}`===s.id),ae=g.findIndex(L=>`${L.id}`===l.id),te=Le([...g],T,ae);f(te),j(!0)}},[r]),V=ne({data:r,columns:q,getCoreRowModel:le(),getRowId:n=>`${n.id}`,debugTable:!0,debugHeaders:!0,debugColumns:!0});return e.jsx("div",{className:"grid grid-cols-2 gap-2",children:e.jsx(De,{open:c,onOpenChange:d,children:e.jsxs(ve,{side:"bottom",children:[e.jsxs(Ne,{children:[e.jsx(Te,{children:"Lesson Page List"}),e.jsx(Me,{children:"This is the list of lesson pages."})]}),e.jsxs("div",{className:"flex-1 overflow-auto px-4 py-1 lg:flex-row lg:space-y-0 lg:space-x-12",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ce,{actions:[]}),e.jsxs(B,{className:"space-x-1",size:"sm",onClick:F,disabled:!h,children:[e.jsx(Ee,{size:18}),e.jsx("span",{children:"Save"})]}),e.jsxs(B,{className:"space-x-1",onClick:m,disabled:t.isPending,size:"sm",children:[e.jsx(ss,{size:18})," ",e.jsx("span",{children:"Add"})]})]}),e.jsx(Ce,{className:"p-4 mx-auto max-w-[600px] max-h-[70vh] overflow-auto",children:e.jsx(Oe,{collisionDetection:$e,modifiers:[Re],onDragEnd:se,sensors:ee,children:e.jsxs(ie,{children:[e.jsx(de,{children:V.getHeaderGroups().map(n=>e.jsx(O,{children:n.headers.map(s=>{const l=i.useMemo(()=>{var g,T;return P((g=s.column.columnDef.meta)!=null&&g.sizeBorderStyle?P("drop-shadow-[0_1px_2px_rgb(0_0_0_/_0.1)] dark:drop-shadow-[0_1px_2px_rgb(255_255_255_/_0.1)] lg:drop-shadow-none","bg-background transition-colors duration-200 group-hover/row:bg-muted group-data-[state=selected]/row:bg-muted","sticky left-6 md:table-cell"):"",((T=s.column.columnDef.meta)==null?void 0:T.className)||"")},[s.column.columnDef.meta]);return e.jsx(ue,{colSpan:s.colSpan,className:l,children:s.isPlaceholder?null:s.column.getCanSort()?e.jsx(me,{column:s.column,title:String(s.column.columnDef.header)}):G(s.column.columnDef.header,s.getContext())},s.id)})},n.id))}),e.jsx(pe,{children:r.length>0?e.jsx(qe,{items:Z,strategy:Ve,children:V.getRowModel().rows.map(n=>e.jsx(os,{row:n},n.id))}):e.jsx(O,{children:e.jsx(U,{colSpan:q.length,className:"h-24 text-center",children:"No results."})})})]})})})]}),e.jsx(ke,{})]})})})}function os({row:c}){const{setNodeRef:d,transform:u,transition:x,isDragging:b}=J({id:`${c.original.id}`}),p={transform:Ke.Transform.toString(u),transition:x,opacity:b?.8:1,zIndex:b?1:0,position:"relative"};return e.jsx(O,{ref:d,style:p,className:`group/row ${c.getIsSelected()?"bg-muted/50":""}`,"data-state":c.getIsSelected()&&"selected",children:c.getVisibleCells().map(r=>{var a,t;const f=P((a=r.column.columnDef.meta)!=null&&a.sizeBorderStyle?P("drop-shadow-[0_1px_2px_rgb(0_0_0_/_0.1)] dark:drop-shadow-[0_1px_2px_rgb(255_255_255_/_0.1)] lg:drop-shadow-none","bg-background transition-colors duration-200 group-hover/row:bg-muted group-data-[state=selected]/row:bg-muted","sticky left-6 md:table-cell"):"",((t=r.column.columnDef.meta)==null?void 0:t.className)||"");return e.jsx(U,{className:f,children:G(r.column.columnDef.cell,r.getContext())},r.id)})})}const rs=({rowId:c})=>{const{attributes:d,listeners:u}=J({id:c});return e.jsx("div",{...d,...u,className:"cursor-grab active:cursor-grabbing",children:e.jsx(Ae,{className:"h-4 w-4 text-muted-foreground"})})},ns=S.object({title:S.string().min(1,{message:"Title is required."}),description:S.string().optional(),lesson_batch:S.string().min(1,{message:"Lesson batch is required."}),is_available_on_free:S.boolean().optional(),order:S.number().optional()}),z=w.create(c=>{const d=w.useModal(),u=i.useMemo(()=>c.recordId?"edit":"create",[c.recordId]),{showSuccessToast:x,showErrorToast:b}=R(),p=Qe({schema:ns,apiService:Ye({url:"/lessons/lessons"}),queryKey:"lessons",invalidateQueriesOnMutate:!0,initialMode:u,recordId:c.recordId||null,defaultValues:{title:"",description:""},notifications:{onSuccess:a=>{x({title:a,duration:2e3})},onError:a=>{b({title:a,duration:2e3})}},transformToForm(a,t){const h={...a};return t.action==="load"&&(a.lesson_batch&&(h.lesson_batch=`${a.lesson_batch.id}`),a.order&&(h.order=Number(a.order))),h}}),r=$({queryKey:["lesson-batches"],queryFn:()=>y({url:"/lessons/batches/",method:"GET",query:{disablePagination:!0}})}),f=i.useMemo(()=>{var a;return(a=r.data)==null?void 0:a.map(t=>({label:t.title,value:`${t.id}`}))},[r.data]);return i.useEffect(()=>{var a,t;(a=c.defaultValues)!=null&&a.lesson_batch&&p.form.setValue("lesson_batch",`${(t=c.defaultValues.lesson_batch)==null?void 0:t.id}`)},[c.defaultValues]),e.jsx(Je,{formHook:p,modal:d,displayType:"dialog",getTitle:a=>a.formMode==="edit"?"Edit Lesson":"Create Lesson",formName:"lessons-form",children:({control:a})=>e.jsx(Xe,{...p.form,children:e.jsxs("div",{className:"space-y-4 p-0.5 mb-6",children:[e.jsx(C,{control:a,name:"title",render:({field:t})=>e.jsxs(D,{className:"grid grid-cols-6 items-center space-y-0 gap-x-4 gap-y-1",children:[e.jsx(v,{className:"col-span-2 text-right",children:"Title"}),e.jsx(M,{children:e.jsx(H,{placeholder:"Title",className:"col-span-4",autoComplete:"off",...t})}),e.jsx(k,{className:"col-span-4 col-start-3"})]})}),e.jsx(C,{control:a,name:"description",render:({field:t})=>e.jsxs(D,{className:"grid grid-cols-6 items-center space-y-0 gap-x-4 gap-y-1",children:[e.jsx(v,{className:"col-span-6 text-right",children:"Description"}),e.jsx(M,{children:e.jsx(Ge,{placeholder:"Description",className:"col-span-6 mt-4",autoComplete:"off",...t})}),e.jsx(k,{className:"col-span-4 col-start-3"})]})}),e.jsx(C,{control:a,name:"lesson_batch",render:({field:t})=>e.jsxs(D,{className:"grid grid-cols-6 items-center space-y-0 gap-x-4 gap-y-1",children:[e.jsx(v,{className:"col-span-2 text-right",children:"Lesson Batch"}),e.jsx(We,{defaultValue:t.value,onValueChange:t.onChange,placeholder:"Select",className:"col-span-4",items:f,isControlled:!0}),e.jsx(k,{className:"col-span-6 col-start-3"})]})}),e.jsx(C,{control:a,name:"is_available_on_free",render:({field:t})=>e.jsxs(D,{className:"grid grid-cols-6 items-center space-y-0 gap-x-4 gap-y-1",children:[e.jsx(v,{className:"col-span-2 text-right",children:"Is Available on Free"}),e.jsx(M,{children:e.jsx(we,{className:"col-span-4",checked:t.value,onCheckedChange:t.onChange})})]})}),e.jsx(C,{control:a,name:"order",disabled:p.formMode!=="edit",render:({field:t})=>e.jsxs(D,{className:"grid grid-cols-6 items-center space-y-0 gap-x-4 gap-y-1",children:[e.jsx(v,{className:"col-span-2 text-right",children:"Order"}),e.jsx(M,{children:e.jsx(H,{placeholder:"Order",type:"number",className:"col-span-4",autoComplete:"off",...t,onChange:h=>{const j=h.target.value;j!==""&&t.onChange(Number(j))}})}),e.jsx(k,{className:"col-span-4 col-start-3"})]})})]})})})}),_=K(),ls=()=>{const[c,d]=i.useState(!1),[u,x]=i.useState(null),b=i.useCallback(r=>{x(r),d(!0)},[]),p=i.useCallback(()=>{d(!1)},[]);return{open:c,openDrawer:b,closeDrawer:p,setRecordId:x,recordId:u}};function cs(){const c=oe({from:"/_layout/lessons/lessons"}),d=i.useMemo(()=>{const{batch_id:o}=c;return o||null},[c]),u=re(),{showSuccessToast:x}=R(),b=N({mutationFn:o=>y({url:`/lessons/lessons/${o}/`,method:"DELETE"})}),p=$({queryKey:["lesson-batches",d],queryFn:()=>y({url:`/lessons/batches/${d}`,method:"GET"}),enabled:!!d}),r=ls(),f=i.useMemo(()=>[_.accessor("id",{header:"ID",meta:{filter:{type:"text",displayType:"toolbar"}},enableHiding:!1}),_.accessor("title",{header:"Title",enableSorting:!1,meta:{filter:{type:"text",displayType:"toolbar"},sizeBorderStyle:!0},cell:({row:o})=>e.jsx(A,{className:"max-w-36",children:o.getValue("title")}),enableHiding:!1}),_.accessor("lesson_batch",{header:"Lesson Batch",enableSorting:!1,cell:({row:o})=>{var m;return e.jsx(A,{className:"max-w-36",children:(m=o.original.lesson_batch)==null?void 0:m.title})},meta:{filter:{type:"select",options:[],displayType:"toolbar",query:{key:["lesson-batches"],fetchOptionsUrl:"/lessons/batches",transformResponse:o=>o.map(m=>({label:m.title,value:`${m.id}`}))}}}}),_.accessor("is_available_on_free",{header:"Is Available on Free",enableSorting:!1,cell:({row:o})=>o.getValue("is_available_on_free")?"Yes":"No",meta:{filter:{type:"select",options:[{label:"Yes",value:"true"},{label:"No",value:"false"}],displayType:"toolbar"}}}),_.accessor("order",{header:"Order",enableSorting:!0,cell:({row:o})=>o.getValue("order")?o.getValue("order"):"-"}),_.display({id:"actions",cell:({row:o})=>e.jsx(Q,{row:o,actions:{openPages:{label:"Open Pages",shortcutIcon:e.jsx(Ze,{}),callback:({row:m})=>{r.openDrawer(m.original.id)}}},defaultActions:{edit:{callback:({row:m})=>{w.show(z,{recordId:m.original.id,record:m.original})}},delete:{callback:({row:m})=>{w.show(Y,{}).then(({result:F})=>{F&&(x({title:"Lesson deleted successfully",duration:2e3}),b.mutateAsync(m.original.id).then(()=>{h.query.refetch()}))})}}}})})],[u]),[a,t]=i.useState(!1),h=he({name:"lessons",url:"/lessons/lessons",columns:f,enabled:a,transformToApiParams(o){const m={...o};return o!=null&&o.lesson_batch&&(m.batch_id=o.lesson_batch,delete m.lesson_batch),m}});i.useEffect(()=>{d&&h.datatable.table.setColumnFilters(o=>[...o,{id:"lesson_batch",value:`${d}`}]),t(!0)},[d]);const j=i.useCallback(()=>{as(z,{defaultValues:{lesson_batch:p.data}})},[p.data]);return e.jsxs(e.Fragment,{children:[e.jsxs(xe,{fixed:!0,children:[e.jsx(ye,{}),e.jsxs("div",{className:"ml-auto flex items-center space-x-4",children:[e.jsx(be,{}),e.jsx(fe,{})]})]}),e.jsxs(je,{children:[e.jsx(ts,{lessonId:r.recordId,open:r.open,onOpenChange:o=>!o&&r.closeDrawer()}),e.jsx(ge,{resource:h,topbar:{title:"Lesson List",subtitle:"Manage your lessons."},actions:[{id:"add",label:"Add",renderType:"panel",callback:j,shortcutIcon:e.jsx(es,{})}]})]})]})}const Ps=cs;export{Ps as component};
