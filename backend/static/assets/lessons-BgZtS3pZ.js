import{j as e,N as n,r as l,a as S,b as C}from"./index-BFkE31IL.js";import{a as D,s as F}from"./use-auth-DHccd34A.js";import{u as M,c as L,C as I,L as x,D as E}from"./component-base-rkrblrFW.js";import{D as P,a as _}from"./delete-confirm-nice-dialog-a-e420zC.js";import{H as k,T as A,P as B,M as H}from"./theme-switch-DqUBxbL4.js";import{S as R}from"./search-DUc9O2sE.js";import{u as N,I as q}from"./use-custom-toast-CqH72_jF.js";import{c as $,u as z}from"./use-resource-DK3NFxGu.js";import{z as f,F as O,a as h,b as g,c as b,d as j,e as y}from"./index-RzghFC-a.js";import{c as V}from"./createReactComponent-D3fbIqZl.js";import{B as K}from"./book-open-3HDu-dIr.js";import{P as Q}from"./plus-CBxvFzmc.js";import"./search-context-Cmagidv2.js";import"./IconSun-DCedqkE3.js";import"./badge-DAHE-SyF.js";function G({className:o,...i}){return e.jsx("textarea",{"data-slot":"textarea",className:V("border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-transparent px-3 py-2 text-base shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",o),...i})}const J=f.object({title:f.string().min(1,{message:"Title is required."}),description:f.string().optional()}),T=n.create(o=>{const i=n.useModal(),m=l.useMemo(()=>o.recordId?"edit":"create",[o.recordId]),{showSuccessToast:u,showErrorToast:p}=N(),c=M({schema:J,apiService:L({url:"/lessons/lessons"}),queryKey:"lessons",invalidateQueriesOnMutate:!0,initialMode:m,recordId:o.recordId,defaultValues:{title:"",description:""},notifications:{onSuccess:t=>{u({title:t,duration:2e3})},onError:t=>{p({title:t,duration:2e3})}}});return e.jsx(I,{formHook:c,modal:i,displayType:"dialog",getTitle:t=>t==="edit"?"Edit Lesson":"Create Lesson",formName:"lessons-form",children:({control:t})=>e.jsx(O,{...c.form,children:e.jsxs("div",{className:"space-y-4 p-0.5",children:[e.jsx(h,{control:t,name:"title",render:({field:r})=>e.jsxs(g,{className:"grid grid-cols-6 items-center space-y-0 gap-x-4 gap-y-1",children:[e.jsx(b,{className:"col-span-2 text-right",children:"Title"}),e.jsx(j,{children:e.jsx(q,{placeholder:"Title",className:"col-span-4",autoComplete:"off",...r})}),e.jsx(y,{className:"col-span-4 col-start-3"})]})}),e.jsx(h,{control:t,name:"description",render:({field:r})=>e.jsxs(g,{className:"grid grid-cols-6 items-center space-y-0 gap-x-4 gap-y-1",children:[e.jsx(b,{className:"col-span-6 text-right",children:"Description"}),e.jsx(j,{children:e.jsx(G,{placeholder:"Description",className:"col-span-6 mt-4",autoComplete:"off",...r})}),e.jsx(y,{className:"col-span-4 col-start-3"})]})})]})})})}),d=$();function U(){const o=S({from:"/_layout/lessons/lessons"}),i=C(),{showSuccessToast:m}=N(),u=D({mutationFn:s=>F({url:`/lessons/lessons/${s}/`,method:"DELETE"})}),p=l.useMemo(()=>[d.accessor("id",{header:"ID",meta:{filter:{type:"text",displayType:"toolbar"}},enableHiding:!1}),d.accessor("title",{header:"Title",enableSorting:!1,meta:{filter:{type:"text",displayType:"toolbar"},sizeBorderStyle:!0},cell:({row:s})=>e.jsx(x,{className:"max-w-36",children:s.getValue("title")}),enableHiding:!1}),d.accessor("lesson_batch",{header:"Lesson Batch",enableSorting:!1,cell:({row:s})=>{var a;return e.jsx(x,{className:"max-w-36",children:(a=s.original.lesson_batch)==null?void 0:a.title})},meta:{filter:{type:"select",options:[],displayType:"toolbar"}}}),d.display({id:"actions",cell:({row:s})=>e.jsx(P,{row:s,actions:{openPages:{label:"Open Pages",shortcutIcon:e.jsx(K,{}),callback:({row:a})=>{i({to:`/lessons/${a.original.id}/pages`,params:{lesson_id:`${a.original.id}`}})}}},defaultActions:{edit:{callback:({row:a})=>{n.show(T,{recordId:a.original.id,record:a.original})}},delete:{callback:({row:a})=>{n.show(_,{}).then(({result:w})=>{w&&(m({title:"Lesson deleted successfully",duration:2e3}),u.mutateAsync(a.original.id).then(()=>{r.query.refetch()}))})}}}})})],[i]),[c,t]=l.useState(!1),r=z({name:"lessons",url:"/lessons/lessons",columns:p,enabled:c,transformToApiParams(s){const a={...s};return s!=null&&s.lesson_batch&&(a.batch_id=s.lesson_batch,delete a.lesson_batch),a}});l.useEffect(()=>{const{batch_id:s}=o;s&&r.datatable.table.setColumnFilters(a=>[...a,{id:"lesson_batch",value:`${s}`}]),t(!0)},[o]);const v=l.useCallback(()=>{n.show(T,{})},[]);return e.jsxs(e.Fragment,{children:[e.jsxs(k,{fixed:!0,children:[e.jsx(R,{}),e.jsxs("div",{className:"ml-auto flex items-center space-x-4",children:[e.jsx(A,{}),e.jsx(B,{})]})]}),e.jsx(H,{children:e.jsx(E,{resource:r,topbar:{title:"Lesson List",subtitle:"Manage your lessons."},actions:[{id:"add",label:"Add",renderType:"panel",callback:v,shortcutIcon:e.jsx(Q,{})}]})})]})}const me=U;export{me as component};
