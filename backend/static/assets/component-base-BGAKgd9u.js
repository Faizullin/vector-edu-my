import{r as m,j as n,v as J,s as O}from"./index-DQh6-uld.js";import{h as N}from"./handle-server-error-BxJ_sWNo.js";import{u as R,s as B}from"./zod-DllzZRz3.js";import{u as Q}from"./useMutation-DppR1fuU.js";import{B as T}from"./index-DxnMLqFP.js";import{D as U,a as W,b as X,c as Y,e as k,d as H}from"./scroll-area-Dbi-VXH4.js";import{S as ee,o as re,p as te,q as se,r as ae,s as ne,Z as oe}from"./dropdown-menu-DzwRwAUd.js";function fe(h){const{schema:s,defaultValues:i,transformToApi:j=a=>a,fetchFn:C,notifications:t,onSuccess:c}=h,[g,v]=m.useState(null),d=R({resolver:B(s),defaultValues:i,mode:"onChange"}),f={success:(a,u)=>{var l;(l=t==null?void 0:t.onSuccess)==null||l.call(t,a,u)},error:(a,u)=>{var w;const l=u instanceof Error?u:new Error(a);v(l),(w=t==null?void 0:t.onError)==null||w.call(t,a,u)},loading:a=>{var u;(u=t==null?void 0:t.onLoading)==null||u.call(t,a)}},x=Q({mutationFn:async a=>{const u=j(a);return await C(u)},onMutate:()=>{f.loading("Saving...")},onSuccess:a=>{f.success("Saved successfully"),c==null||c(a)},onError:a=>{N(a)}}),E=d.handleSubmit(a=>{x.mutate(a)},()=>{v(new Error("Form validation failed"))}),o=m.useCallback(()=>{d.reset(i),v(null)},[i]);return{form:d,handleSubmit:E,handleReset:o,isSubmitting:x.isPending,mutation:x,error:g,setError:v}}const pe=({url:h})=>({get:async s=>O({url:`${h}/${s}/`,method:"GET"}),create:async s=>O({url:`${h}/`,method:"POST",body:s}),update:async(s,i)=>O({url:`${h}/${s}/`,method:"PATCH",body:i})});function ye(h){const{schema:s,defaultValues:i,initialMode:j="create",initialRecord:C=null,recordId:t,transformToForm:c=(e,r)=>e,transformToApi:g=e=>e,switchToEditOnCreate:v=!0,apiService:d,onCreateSuccess:f,onUpdateSuccess:x,onLoadSuccess:E,notifications:o,queryKey:a="records",invalidateQueriesOnMutate:u=!0}=h,[l,w]=m.useState(j),[S,F]=m.useState(t),[D,I]=m.useState(C),[V,L]=m.useState(!1),[Z,P]=m.useState(null),M=J(),p=R({resolver:s?B(s):void 0,defaultValues:i,mode:"onChange"}),y={success:(e,r)=>{var b;(b=o==null?void 0:o.onSuccess)==null||b.call(o,e,r)},error:(e,r)=>{var K;const b=r instanceof Error?r:new Error(e);P(b),(K=o==null?void 0:o.onError)==null||K.call(o,e,r)},loading:e=>{var r;(r=o==null?void 0:o.onLoading)==null||r.call(o,e)}},$=Q({mutationFn:async e=>{if(!d)throw new Error("API service not provided");const r=g(e);return await d.create(r)},onMutate:()=>{y.loading("Creating record...")},onSuccess:e=>{I(e),F(e.id),y.success("Record created successfully",e),v&&(w("edit"),p.reset(c(e,{action:"post"}))),u&&M.invalidateQueries({queryKey:[a]}),f==null||f(e)},onError:e=>{N(e,{form:p})}}),q=Q({mutationFn:async e=>{if(!d)throw new Error("API service not provided");const r=g(e);return await d.update(`${S}`,r)},onMutate:()=>{y.loading("Updating record...")},onSuccess:e=>{I(e),y.success("Record updated successfully",e),u&&(M.invalidateQueries({queryKey:[a,e.id]}),M.invalidateQueries({queryKey:[a]})),x==null||x(e)},onError:e=>{N(e,{form:p})}});m.useEffect(()=>{S&&d&&(l==="edit"||l==="view")&&A(`${S}`).catch(e=>y.error("Failed to load record",e))},[S,l]),m.useEffect(()=>{t?(l==="create"&&w("edit"),S!==t&&F(t)):(p.reset(i||{}),w("create"))},[t]);const A=async e=>{if(!d)throw new Error("API service not provided");L(!0),y.loading("Loading record...");try{const r=await d.get(e);return I(r),F(r.id),l!=="create"&&p.reset(c(r,{action:"load"})),E==null||E(r),M.setQueryData([a,e],r),r}catch(r){throw y.error("Failed to load record",r),r}finally{L(!1)}},_=p.handleSubmit(e=>{l==="edit"?q.mutate(e):$.mutate(e)},()=>{y.error("Form validation failed")}),z=m.useCallback(()=>{l==="create"?p.reset(i||{}):D?p.reset(c(D,{action:"reset"})):p.reset(),P(null)},[l,D,i]),G=m.useCallback(async e=>{const r=e||S;if(!r)return y.error("No record ID provided"),Promise.reject(new Error("No record ID provided"));try{await A(`${r}`)}catch(b){return Promise.reject(b)}},[S]);return{form:p,formMode:l,setFormMode:w,recordId:S,setRecordId:F,record:D,isLoading:V,isSubmitting:$.isPending||q.isPending,isViewMode:l==="view",error:Z,setError:P,handleSubmit:_,handleReset:z,handleLoad:G,loadRecord:A,createMutation:$,updateMutation:q,notify:y}}const ve=({formName:h,formHook:s,modal:i,displayType:j,getTitle:C,isProcessing:t=!1,children:c,getSubmitButtonText:g})=>{const v=m.useMemo(()=>g?g(s):s.formMode==="create"?"Create":"Save Changes",[s,g]),d=m.useMemo(()=>C(s),[C,s]);if(j==="dialog")return n.jsx(U,{open:i.visible,onOpenChange:f=>{f||i.hide(),s.form.reset()},children:n.jsx(W,{className:"!max-w-[1000px]",children:n.jsxs("form",{id:h,onSubmit:s.handleSubmit,children:[n.jsxs(X,{className:"text-left",children:[n.jsx(Y,{children:d}),n.jsx(k,{children:"Click save when you are done."})]}),n.jsx("div",{className:"-mr-4 w-full overflow-y-auto pt-4 pr-4",children:typeof c=="function"?c(s.form):c}),n.jsx(H,{children:n.jsx(T,{type:"submit",form:h,disabled:t,children:v})})]})})});if(j==="drawer")return n.jsx(ee,{open:i.visible,onOpenChange:f=>{f||i.hide(),s.form.reset()},children:n.jsx(re,{className:"flex flex-col",children:n.jsxs("form",{onSubmit:s.handleSubmit,children:[n.jsxs(te,{className:"text-left",children:[n.jsx(se,{children:d}),n.jsx(ae,{children:"Click save when you are done."})]}),typeof c=="function"?c(s.form):c,n.jsxs(ne,{className:"gap-2",children:[n.jsx(oe,{asChild:!0,children:n.jsx(T,{variant:"outline",children:"Close"})}),n.jsx(T,{form:h,type:"submit",disabled:t,children:v})]})]})})})};export{ve as C,ye as a,pe as c,fe as u};
