import{r as d,D as i}from"./main-CUfsI3AY.js";import{u as C,a as F}from"./useApi-muFL2Lva.js";import{u as M}from"./CSelect-DrjsPD9C.js";function k({getUrl:u,schema:p,parseResponse:m,parseFormData:g,initialValues:y={},onSubmit:r}){const[t,f]=d.useState(null),l=C(),c=d.useMemo(()=>t?u(t):u(),[t]),w=F(c,{useInitial:!1,usePagination:!1}),E=M({enableReinitialize:!0,initialValues:y,validationSchema:p,onSubmit:async(s,n)=>{try{const e=g(s);let a;t!=null&&t.id?(a=await l.mutate(c,"PUT",e),i.success("Updated successfully!")):(a=await l.mutate(c,"POST",e),i.success("Created successfully!"));const o=m(a);r==null||r({status:"success",payload:o,response:a}),f(o),n.setSubmitting(!1)}catch(e){h(e,n),r==null||r({status:"error",payload:e})}}}),h=(s,n)=>{var e,a;if(((e=s==null?void 0:s.response)==null?void 0:e.status)===400&&((a=s.response)!=null&&a.data)){const o=s.response.data;o.non_field_errors&&i.error(o.non_field_errors.join(", ")),o.message&&Object.entries(o.message).forEach(([v,_])=>{n.setFieldError(v,_)})}else i.error((s==null?void 0:s.message)||"Something went wrong.");n.setSubmitting(!1)};return{record:t,setRecord:f,saveControl:l,getControl:w,formik:E}}export{k as u};
