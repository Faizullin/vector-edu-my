import{j as e,N as n,r as c,s as m}from"./index-DQh6-uld.js";import{c as C,L as p,u as D,D as N}from"./use-resource-D_Sf-gj9.js";import{D as v,a as R}from"./delete-confirm-nice-dialog-GvGx0jE2.js";import{H as S,T as _,P as M,M as T}from"./theme-switch-CZRbTvJb.js";import{S as k}from"./search-Cxg_x99o.js";import{u as h}from"./use-custom-toast-M785XCYm.js";import{u as x}from"./useMutation-DppR1fuU.js";import{B as f}from"./index-DxnMLqFP.js";import{D as g,a as j,b as y,c as b,S as q,d as w,e as P}from"./scroll-area-Dbi-VXH4.js";import{a as E}from"./use-auth-D3uw0lD2.js";import{c as H}from"./dropdown-menu-DzwRwAUd.js";import{P as L}from"./plus-B1eArzAP.js";import"./badge-CaQ6wKJ8.js";import"./search-context-BRsiDa6R.js";import"./IconSun-DUeqE8X5.js";import"./createReactComponent-CHdwuXdO.js";import"./separator-B8KvN21v.js";import"./handle-server-error-BxJ_sWNo.js";/**
 * @license lucide-react v0.488.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const O=[["path",{d:"M21 17v2a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-2",key:"mrq65r"}],["path",{d:"M21 7V5a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v2",key:"be3xqs"}],["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["path",{d:"M18.944 12.33a1 1 0 0 0 0-.66 7.5 7.5 0 0 0-13.888 0 1 1 0 0 0 0 .66 7.5 7.5 0 0 0 13.888 0",key:"11ak4c"}]],F=H("view",O),I=[{label:"Lesson Page Element Component Use",value:"lesson_page_element_component_use"},{label:"Storage Files Use",value:"storage_files_use"}],V=s=>e.jsx("pre",{className:"whitespace-pre-wrap text-sm bg-gray-100 p-3 rounded-md",children:JSON.stringify(s.loadedData.data,null,2)}),A=s=>e.jsx("pre",{className:"whitespace-pre-wrap text-sm bg-gray-100 p-3 rounded-md",children:JSON.stringify(s.loadedData.data,null,2)}),U=n.create(()=>{const s=n.useModal(),[l,r]=c.useState(null),{showSuccessToast:o,showErrorToast:i}=h(),t=x({mutationFn:a=>m({url:"/reports/record_start/",method:"POST",formData:{name:a}}),onSuccess:()=>{o("Report requested successfully"),s.resolve(!0),s.hide()},onError:a=>{i(a.message)}}),u=c.useCallback(()=>{if(!l){i("Please select a report name");return}t.mutate(l)},[t,l]);return e.jsx(g,{open:s.visible,onOpenChange:a=>{a||s.hide()},children:e.jsxs(j,{className:"!max-w-[1000px]",children:[e.jsxs(y,{className:"text-left",children:[e.jsx(b,{children:"Request Report Confirmation"}),e.jsx(P,{children:"Click save when you are done."})]}),e.jsx("div",{className:"space-y-4 p-0.5 mb-6",children:e.jsxs("select",{className:"w-full",onChange:a=>r(a.target.value),children:[e.jsx("option",{value:"",children:"Select Report Name"}),I.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))]})}),e.jsx(w,{children:e.jsx(f,{size:"sm",onClick:u,disabled:t.isPending,children:"Request"})})]})})}),B={lesson_page_element_component_use:V,storage_files_use:A},J=n.create(s=>{const l=n.useModal(),r=E({queryKey:["reports",s.recordId],queryFn:()=>m({url:`/reports/${s.recordId}/`,method:"GET"})}),o=c.useMemo(()=>r.data?JSON.parse(r.data.content):null,[r.data]),i=c.useMemo(()=>{if(!o)return null;const t=B[o.name];return t?e.jsx(t,{recordObj:r.data,loadedData:o}):null},[o,r.data]);return e.jsx(g,{open:l.visible,onOpenChange:t=>{t||l.hide()},children:e.jsxs(j,{className:"max-w-[600px] max-h-[70vh] overflow-hidden",children:[e.jsx(y,{children:e.jsx(b,{children:"Post Content"})}),e.jsx(q,{className:"mb-4 h-[50vh] w-full overflow-auto p-2",children:r.isPending?e.jsx("div",{className:"flex items-center justify-center h-full",children:"Loading..."}):r.isError?e.jsx("div",{className:"text-red-500",children:r.error.message}):i}),e.jsx(w,{children:e.jsx(f,{onClick:()=>l.hide(),children:"Close"})})]})})}),d=C();function z(){const{showSuccessToast:s}=h(),l=x({mutationFn:t=>m({url:`/reports/${t}/`,method:"DELETE"})}),r=c.useMemo(()=>[d.accessor("id",{header:"ID",meta:{filter:{type:"text",displayType:"toolbar"}},enableHiding:!1}),d.accessor("title",{header:"Title",enableSorting:!1,meta:{filter:{type:"text",displayType:"toolbar"},sizeBorderStyle:!0},cell:({row:t})=>e.jsx(p,{className:"max-w-36",children:t.getValue("title")}),enableHiding:!1}),d.accessor("created_at",{header:"Created At",cell:({row:t})=>e.jsx(p,{className:"max-w-36",children:new Date(t.getValue("created_at")).toLocaleString()})}),d.display({id:"actions",cell:({row:t})=>e.jsx(v,{row:t,actions:{view:{callback:()=>{n.show(J,{recordId:t.original.id})},shortcutIcon:e.jsx(F,{}),label:"View"}},defaultActions:{delete:{callback:({row:u})=>{n.show(R,{}).then(({result:a})=>{a&&(s({title:"Report deleted successfully",duration:2e3}),l.mutateAsync(u.original.id).then(()=>{o.query.refetch()}))})}}}})})],[]),o=D({name:"reports",url:"/reports",columns:r}),i=c.useCallback(()=>{n.show(U,{}).then(t=>{console.log(t),t&&o.query.refetch()})},[]);return e.jsxs(e.Fragment,{children:[e.jsxs(S,{fixed:!0,children:[e.jsx(k,{}),e.jsxs("div",{className:"ml-auto flex items-center space-x-4",children:[e.jsx(_,{}),e.jsx(M,{})]})]}),e.jsx(T,{children:e.jsx(N,{resource:o,topbar:{title:"Report List",subtitle:"Manage your reports."},actions:[{id:"add",label:"Request",renderType:"panel",callback:i,shortcutIcon:e.jsx(L,{})}]})})]})}const de=function(){return e.jsx(z,{})};export{de as component};
